<!DOCTYPE html>
<html lang="kr">
	<head>
		<meta charset="UTF-8">
		<title>XMLHttpRequest</title>
		<script type="text/javascript" src="../../js/jquery-3.6.0.js"></script>
		<style type="text/css">
		</style>
	</head>
	<body>
		<h3>XMLHttpRequest 사용하기</h3>
		<button type="button" id="btnGetA">Get 비동기 방식 호출</button>
		<button type="button" id="btnGetS">Get 동기 방식 호출</button>
		
		<button type="button" id="btnJQ">JQ AJAX 호출</button>
		
		<button type="button" id="btnPostA">POST 비동기 방식 호출</button>
		<button type="button" id="btnPostS">POST 동기 방식 호출</button>
		
		<hr>
		<div id="divResult" style="border: 1px solid; height: 300px;"></div>
		<hr>
		<form action="" method="get" id="fm"> <!-- 요 form값이 obj에 담기게 된다 -->
			아이디 : <input type="get" name="userName">
			비밀번호: <input type="password" name="userPassword">
		</form>
	</body>
		<script>
		
			$("#btnJQ").click(function(){
// 				var obj = {userId:"test01", userPw:"1234"};
				var obj = $("#fm").serialize();
				$.ajax({ // jquery로 ajax 호출하는 메서드
					url: "html1.html" // 호출할 주소(url)
					, type: "get" // 데이터 전송 방식(metohd) - "get" 또는 "post"
// 					, data: {userId:"test01", userPw:"1234"}; // 이것보다는 위에서 변수를 지정해서 넣는 것이 좋음.
					, data: obj // 전송할 데이터
					, dataType: "html" // 결과로 받은 데이터의 형식(서버로부터 받은 데이터 유형) - html, json, text, xml
					, success: function(data){ // 성공 시 처리할 작업 (보통 성공한다면 data를 파라미터로 가져온다)
						alert("성공");
					//data를 가공해서 화면에 세팅...
					}
				, error: function(xhr){ // 오류 시 처리할 작업 (보통 오류가 난다면 xhr을 파라미터로 받음)
					alert("실패");
					// xhr에 오류코드와 오류메시지 포함
				}
				}); 
			});		
		
		
			$("#btnGetA").click(function(){
				// XMLHttpRequest 객체로 호출하기
				
				// 1) XMLHttpRequest 객체 생성
				var xhttp = new XMLHttpRequest();
			
				// 2) 서버(, 페이지 등) 연결 - open(method, url, async)
				var url = "html1.html";
				xhttp.open("GET", url, true);
				
				// 3) 서버(, 페이지 등) 전송
				xhttp.send();
				
				// 4) 결과처리하기
				xhttp.onreadystatechange = function(){
					if(this.readyState == 4 && this.status == 200){ // 서버에서 요청이 정상처리인 상태
				 	// 요청이 처리 완료됨(데이터 받음)상태  && 정상 처리 되었을 때 화면 처리 할 내용
				 	console.log(this.responseText);
				 	alert(this.responseText);
					$("#divResult").html(this.responseText);
					} else {
						alert("ho");
					}
				}
			});
			
			
			$("#btnGetS").click(function(){
				// XMLHttpRequest 객체로 호출하기
				
				// 1) XMLHttpRequest 객체 생성
				var xhttp = new XMLHttpRequest();
			
				// 2) 서버(, 페이지 등) 연결 - open(method, url, async)
				var url = "html1.html";
				xhttp.open("GET", url, false); // 동기식 호출로 변경(false)
				
				// 4) 결과처리하기 (3다음에 있으면 진행이 안되기에 순서를 뒤바꿈. 주석처리한 내용은 순서 뒤바꾸지 않은 상태 ) 
				xhttp.onreadystatechange = function(){ // 그래서 이벤트가 호출되지 않은 상태
					if(this.readyState == 4 && this.status == 200){ 
				 	console.log(this.responseText);
					$("#divResult").html(this.responseText);
					}
				}
				
				// 3) 서버(, 페이지 등) 전송
				xhttp.send(); // 이미 0~4 까지 전송이 끝난 상태 이미 4상태
				
			});
		
				 
// 				tomcat 사용시
// 				주소가 바뀜
// 				http://localhost:9000/JqueryPro/jquery/jquery9/210405_jq9_1_ajax_request.html
				
				
		</script>
</html>